@model EpicorWeb.Models.Users
@{
	var listGroup = ViewBag.GroupAll;
}
<!-- Modal -->
<div class="modal fade" id="editGroups" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="exampleModalLabel">Cập nhật Người Dùng</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body">
				<div class="row">
					<div class="col-md-12">
						<form id="editUsersForm">
							<div asp-validation-summary="ModelOnly" class="text-danger"></div>
							<div class="form-group">
								<label asp-for="ID" class="control-label"></label>
								<input asp-for="ID" class="form-control" id="IDGroup" name="ID" value="@Model.ID" readonly />
								<span asp-validation-for="ID" class="text-danger"></span>
							</div>
							<div class="form-group">
								<label asp-for="Name" class="control-label"></label>
								<input asp-for="Name" class="form-control" id="NameGroup" name="Name" value="@Model.Name" readonly />
								<span asp-validation-for="Name" class="text-danger"></span>
							</div>
							<div class="form-group">
								<label asp-for="GroupID" class="control-label"></label>
								<select class="form-control" asp-for="GroupID" id="GroupID" asp-items="@(new SelectList(listGroup, "ID", "Name", Model.GroupID))">
								</select>
								<span asp-validation-for="GroupID" class="text-danger"></span>
							</div>
							<div class="form-group">
								<input type="submit" value="Lưu" class="btn btn-primary" id="btnEditUsers" />
							</div>
							<div id="resultMessage" style="color: green;"></div>
							<div class="modal-footer">
								<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Thoát</button>
							</div>
						</form>
						@* <form asp-action="EditUsers" method="post">
						<div asp-validation-summary="ModelOnly" class="text-danger"></div>
						<div class="form-group">
						<label asp-for="ID" class="control-label"></label>
						<input asp-for="ID" class="form-control" id="IDGroup" name="ID" value="@Model.ID" readonly />
						<span asp-validation-for="ID" class="text-danger"></span>
						</div>
						<div class="form-group">
						<label asp-for="Name" class="control-label"></label>
						<input asp-for="Name" class="form-control" id="NameGroup" name="Name" value="@Model.Name" readonly />
						<span asp-validation-for="Name" class="text-danger"></span>
						</div>
						<div class="form-group">
						<label asp-for="GroupID" class="control-label"></label>
						<select class="form-control" asp-for="GroupID" asp-items="@(new SelectList(listGroup, "ID", "Name", Model.GroupID))">
						</select>
						<span asp-validation-for="GroupID" class="text-danger"></span>
						</div>
						<div class="form-group">
						<input type="submit" value="Lưu" class="btn btn-primary" id="btnEditUsers" />
						</div>
						<div id="resultMessage" style="color: green;"></div>
						<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Thoát</button>
						</div>
						</form> *@
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<script>
	$(document).ready(function () {
		$('#btnEditUsers').on('click', function (event) {
			event.preventDefault(); // Ngăn không cho form submit bình thường

			var formData = {
				ID: $('#IDGroup').val(),
				Name: $('#NameGroup').val(),
				GroupID: $('#GroupID').val()
			};

			$.ajax({
				url: '@Url.Action("EditUsers", "UsersController")', // Thay YourControllerName bằng tên controller của bạn
				type: 'POST',
				data: formData,
				success: function (response) {
					$('#resultMessage').text('Lưu thành công!'); // Hiển thị thông báo thành công
					$('#resultMessage').css('color', 'green');
					$('#editGroups').modal('hide');
					// Cập nhật lại danh sách người dùng
					$('#usersListContainer').html(response);
					// Đảm bảo rằng các sự kiện 'click' được gắn lại cho các nút edit
					initUpdateButtonEvent();
					$('#zero_config').DataTable({
						"language": {
							"paginate": {
								"previous": "<<", // Thay đổi nút Previous thành <<
								"next": ">>"      // Thay đổi nút Next thành >>
							}
						}
					});
				},
				error: function () {
					$('#resultMessage').text('Đã xảy ra lỗi.'); // Hiển thị thông báo lỗi
					$('#resultMessage').css('color', 'red');
				}
			});
		});
	});
	// Định nghĩa hàm gắn sự kiện click cho nút "Sửa"
	function initUpdateButtonEvent() {
		$('.btnEditUser').off('click').on('click', function () {
			var id = $(this).data('id');
			var name = $(this).data('name');
			var groupname = $(this).data('groupname');
			var groupid = $(this).data('groupid');

			openEditGroupsModal(id, name, groupname, groupid);
		});
	}

	function openEditGroupsModal(id, name, groupname, groupid) {
		$.ajax({
			url: '/UsersController/EditUsers',
			type: 'GET',
			data: { id: id, name: name, groupname: groupname, groupid: groupid },
			success: function (modalHtml) {
				$('#myModalContainer').html(modalHtml);
				$('#editGroups').modal('show');
			},
			error: function () {
				alert('Đã xảy ra lỗi khi gọi controller.');
			}
		});
	}
</script>
